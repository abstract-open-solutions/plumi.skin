<?xml version="1.0" encoding="utf-8"?> 
<rss version="2.0" 
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal"  
     xmlns:itunes="http://www.itunes.com/DTDs/Podcast-1.0.dtd"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:media="http://search.yahoo.com/mrss/"     
     tal:define="results python:here.getSyndicatableContent();"
     tal:on-error="nothing">
<tal:x define="dummy python:request.RESPONSE.setHeader('Content-Type', 'text/xml')" />
    <channel>

        <title tal:define="portal_title here/portal_properties/title;
            here_title here/title_or_id;
            template_title template/title_or_id;
            here_title python:test(portal_title != here_title, here_title, template_title)"
            tal:content="string:$portal_title * $here_title">Title of page</title>
        <link tal:content="here/absolute_url"></link>
        <description tal:content="here/Description">
        </description>
        <itunes:summary tal:content="here/Description"></itunes:summary>
        <itunes:image tal:attributes="href string:${here/portal_url}/logo.gif" />
        <!--itunes:image href="http://www.okaygreat.com/wp-content/uploads/2009/02/clipart.jpg" /-->
        <itunes:link rel="image" type="" tal:attributes="href string:${here/portal_url}/logo.gif"></itunes:link>
        <image>
           <link tal:content="string:${here/portal_url}"></link>
           <title title="template_title"></title>
           <url tal:content="string:${here/portal_url}/logo.gif"></url>
           <height>300</height>
           <width>300</width>
        </image>        
        <language>en-us</language>
        <generator>Plone 2.0</generator>

        <tal:block repeat="res results">
            <tal:block define="macros nocall: python:here.getItemMacros(res.portal_type); 
                               item_path python: res.absolute_url();
                               item_path python: res.portal_type=='ATAudio' and item_path+'/file_download/'+res.getId() or item_path;">                              
                  <item>
                      <media:content tal:attributes="url string:${item_path}/thumbnailImage_thumb"/>
                      <media:thumbnail tal:attributes="url string:${item_path}/thumbnailImage_thumb"/>
                      <title tal:content="res/title_or_id"></title>
                      <itunes:subtitle tal:content="res/title_or_id"></itunes:subtitle>
                      <link tal:content="item_path"></link>
                      <description>
                         <div><img tal:attributes="src string:${item_path}/thumbnailImage_thumb"/><span tal:content="res/Description" /></div>
                      </description>
                      <itunes:summary tal:content="res/Description"></itunes:summary>                      
                      <author tal:content="res/Creator"></author>
                      <itunes:author tal:content="res/Creator"></itunes:author>                      
                      <tal:repeat repeat="subj res/Subject">
                          <category tal:content="subj">
                          </category>
                      </tal:repeat>
                      <pubDate tal:content="structure python: DateTime(res.Date()).rfc822()"> </pubDate>                      
                      <metal:block use-macro="macros"/>
                      <enclosure tal:attributes="url string:${res/absolute_url}/@@download/video_file/${res/video_file/filename}" />
                  </item>
            </tal:block>	   	
        </tal:block>

    </channel>
</rss>

